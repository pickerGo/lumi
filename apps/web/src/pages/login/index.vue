<script lang="tsx">
import { defineComponent, ref, toRaw } from 'vue';
import { Checkbox, Select, Button } from 'ant-design-vue';
import { UserAvatar } from '@zsfe/zsui';

import { mockUsers } from '@editor/doc';

import { postLogin } from '#/auth';

const Option = Select.Option;

export default defineComponent({
  setup() {
    const user = ref();

    const handleSelectUser = async () => {
        if (!user.value) {
            return;
        }

        try {
            await postLogin({
                account: user.value?.name,
            });

            location.hash = '#/files';
            location.reload();
        } catch(e) {
            console.error(e);
        }
    }

    return () => (
        <div class="h-full">
            <div class="login-logo"></div>

            <div class="login-main">
                <div class="login-title">登陆</div>

                <div class="flex flex-col gap-6">
                    <div class="login-btn login-btn--apple">
                        <div class="flex items-center w-[120px]">
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20.5511 17.3654C20.2306 18.0991 19.8513 18.7744 19.4118 19.3953C18.8127 20.2418 18.3221 20.8277 17.9441 21.153C17.3581 21.6871 16.7302 21.9606 16.0578 21.9762C15.5752 21.9762 14.9931 21.8401 14.3155 21.564C13.6357 21.2891 13.0109 21.153 12.4397 21.153C11.8406 21.153 11.1981 21.2891 10.5108 21.564C9.82251 21.8401 9.26802 21.9839 8.84407 21.9982C8.19932 22.0254 7.55666 21.7441 6.91518 21.153C6.50575 20.7992 5.99364 20.1925 5.38016 19.3331C4.72193 18.4153 4.18078 17.3511 3.75683 16.1378C3.3028 14.8273 3.0752 13.5583 3.0752 12.3297C3.0752 10.9223 3.38207 9.70852 3.99673 8.69134C4.47981 7.87431 5.12246 7.22981 5.9268 6.75668C6.73114 6.28355 7.60022 6.04244 8.53615 6.02702C9.04826 6.02702 9.71983 6.18399 10.5544 6.4925C11.3866 6.80205 11.9209 6.95903 12.1552 6.95903C12.3304 6.95903 12.924 6.77548 13.9303 6.40954C14.8819 6.07018 15.685 5.92967 16.343 5.98502C18.1259 6.12761 19.4654 6.82409 20.3562 8.07886C18.7616 9.03628 17.9729 10.3773 17.9886 12.0975C18.003 13.4375 18.4935 14.5525 19.4575 15.4378C19.8944 15.8488 20.3823 16.1663 20.9252 16.3919C20.8075 16.7302 20.6832 17.0543 20.5511 17.3654ZM16.462 1.42012C16.462 2.47036 16.0749 3.45097 15.3031 4.3586C14.3717 5.43761 13.2452 6.06111 12.0236 5.96272C12.008 5.83673 11.999 5.70412 11.999 5.56477C11.999 4.55654 12.4419 3.47754 13.2285 2.59531C13.6212 2.14862 14.1206 1.7772 14.7262 1.48091C15.3306 1.18905 15.9022 1.02764 16.4398 1C16.4555 1.1404 16.462 1.28081 16.462 1.42011V1.42012Z" fill="white"></path></svg>
                            Apple登陆
                        </div>
                    </div>
                    <div class="login-btn login-btn--wechat">
                        <div class="flex items-center w-[120px]">
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.00592 3.75091C4.90643 3.69065 1.5 6.62975 1.5 10.0961C1.5 12.097 2.46457 13.8328 4.3317 15.1072C4.3317 15.1072 3.64739 17.3106 3.65712 17.3547C3.66686 17.399 3.81579 17.4858 3.86762 17.4575C3.91945 17.4291 6.34131 16.02 6.34131 16.02C8.07695 16.6013 9.13571 16.4582 9.31642 16.4338C9.32896 16.4321 9.33728 16.431 9.34129 16.4307C9.15606 15.9016 9.03468 15.0776 9.17289 14.301C9.89646 10.2366 14.1616 8.97229 16.4992 9.18828C15.8537 6.25302 13.0499 3.81032 9.00592 3.75091ZM6.15651 7.08691C5.61874 7.08691 5.18287 7.51228 5.18287 8.03707C5.18287 8.56185 5.61874 8.98722 6.15651 8.98722C6.69429 8.98722 7.13027 8.56185 7.13027 8.03707C7.13027 7.51228 6.69429 7.08691 6.15651 7.08691ZM12.0512 7.08691C11.5135 7.08691 11.0775 7.51228 11.0775 8.03707C11.0775 8.56185 11.5135 8.98722 12.0512 8.98722C12.589 8.98722 13.0249 8.56185 13.0249 8.03707C13.0249 7.51228 12.5891 7.08691 12.0512 7.08691Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M22.5 14.9194C22.5 11.9498 19.5565 9.6752 16.1418 9.6752C12.5262 9.6752 9.64244 12.0012 9.64244 14.9706C9.64244 17.9454 12.3853 20.4082 16.146 20.4283C16.9029 20.4325 18.0303 20.2426 18.7905 19.9328C18.7905 19.9328 20.6077 21.0078 20.7095 21C20.8112 20.992 20.8634 20.9133 20.8674 20.8459C20.8715 20.7785 20.2884 19.1005 20.2884 19.1005C21.8488 17.9082 22.5 16.5944 22.5 14.9194ZM13.762 12.1391C13.2863 12.1391 12.9006 12.5161 12.9006 12.9812C12.9006 13.4462 13.2863 13.8232 13.762 13.8232C14.2378 13.8232 14.6235 13.4463 14.6235 12.9812C14.6235 12.5161 14.2378 12.1391 13.762 12.1391ZM18.3685 12.1391C17.8927 12.1391 17.507 12.5161 17.507 12.9812C17.507 13.4462 17.8927 13.8232 18.3685 13.8232C18.8444 13.8232 19.23 13.4463 19.23 12.9812C19.23 12.5161 18.8444 12.1391 18.3685 12.1391Z" fill="white"></path></svg>
                            微信登陆
                        </div>
                    </div>
                    <div class="login-btn login-btn--weibo">
                        <div class="flex items-center w-[120px]">
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.4234 19.7584C6.94603 20.103 3.94392 18.5305 3.71789 16.2512C3.49186 13.9691 6.12885 11.8433 9.6033 11.4987C13.0806 11.154 16.0828 12.7266 16.3059 15.0059C16.5348 17.288 13.8978 19.4167 10.4234 19.7584ZM17.3752 12.1851C17.0796 12.0953 16.8767 12.0374 17.0303 11.6493C17.3665 10.8065 17.4012 10.0796 17.0361 9.55827C16.3551 8.58518 14.489 8.63731 12.3504 9.53221C12.3504 9.53221 11.6781 9.82472 11.852 9.29473C12.1794 8.23764 12.1302 7.35433 11.6202 6.84171C10.461 5.68037 7.3749 6.88516 4.72922 9.52931C2.75003 11.5074 1.59961 13.607 1.59961 15.4229C1.59961 18.8925 6.05351 21.0037 10.4089 21.0037C16.1204 21.0037 19.9194 17.6877 19.9194 15.0551C19.9223 13.4622 18.5806 12.5587 17.3752 12.1851Z" fill="white"></path><path d="M21.1668 5.83392C19.7874 4.30477 17.7532 3.72265 15.8754 4.12232C15.4408 4.21499 15.1655 4.64362 15.2582 5.07514C15.3509 5.50956 15.7769 5.78469 16.2116 5.69201C17.5475 5.40819 18.9934 5.82234 19.9729 6.90838C20.9524 7.99443 21.2189 9.47435 20.7988 10.7718C20.6626 11.1946 20.8944 11.6464 21.3175 11.7826C21.7405 11.9187 22.1926 11.687 22.3288 11.267V11.2641C22.9199 9.44249 22.5461 7.36018 21.1668 5.83392Z" fill="white"></path><path d="M19.051 7.74538C18.3787 7.00108 17.3876 6.71726 16.4748 6.9142C16.101 6.99239 15.8634 7.36309 15.9417 7.73669C16.0228 8.11029 16.3908 8.34777 16.7617 8.26668C17.208 8.17111 17.6948 8.31013 18.0223 8.67214C18.3497 9.03705 18.4395 9.53229 18.2976 9.96671C18.1816 10.3287 18.3787 10.7197 18.7438 10.8384C19.1089 10.9543 19.4972 10.7573 19.616 10.3924C19.9029 9.50333 19.7233 8.48968 19.051 7.74538Z" fill="white"></path><path d="M10.6149 15.629C10.4932 15.8375 10.2237 15.936 10.015 15.8491C9.80641 15.7651 9.74266 15.5305 9.86146 15.3278C9.98317 15.125 10.2411 15.0266 10.4468 15.1077C10.6555 15.183 10.7308 15.4175 10.6149 15.629ZM9.50504 17.0481C9.16889 17.5838 8.44734 17.8184 7.90546 17.5723C7.37227 17.329 7.21289 16.7063 7.54903 16.1821C7.88228 15.6608 8.57774 15.4291 9.11673 15.655C9.66152 15.8896 9.83538 16.5065 9.50504 17.0481ZM10.7685 13.2541C9.11384 12.8226 7.24476 13.648 6.52611 15.1048C5.79297 16.5905 6.50293 18.2413 8.17205 18.7799C9.90493 19.3389 11.945 18.4816 12.6549 16.8801C13.3562 15.3104 12.4811 13.6973 10.7685 13.2541Z" fill="white"></path></svg>
                            微博登陆
                        </div>
                    </div>
                    <div class="login-btn login-btn--mock">
                        <div class="flex items-center w-full">
                            <Select 
                                style="width: 80%"
                                placeholder="请选择用户"
                                onChange={(val) => {
                                    const mockUser = mockUsers.find(item => item.id === val);
                                    user.value = mockUser;
                                }}
                            >
                                {
                                    mockUsers.map(user => (
                                        <Option class="mockUserOption" value={user.id}>
                                            <div class="flex items-center gap-1">
                                                <UserAvatar username={user.name} showText={false} />
                                                {user.name}
                                            </div>
                                        </Option>
                                    ))
                                }
                            </Select>

                            <Button type="primary" onClick={handleSelectUser} disabled={!user.value}>确定</Button>
                        </div>
                    </div>
                </div>

                <div class="login-foot">
                    <Checkbox class="mr-2.5" />我已阅读并同意用户条款和隐私政策
                </div>
            </div>
        </div>
    );
  }
});
</script>

<style scoped lang="less">
.login-logo {
    position: fixed;
    top: 48px;
    left: 48px;

    width: 88px;
    height: 30px;
    background: url('@/assets/logo3.png');
    background-size: contain;
    background-repeat: no-repeat;
}

.login-main {
    display: flex;
    flex-direction: column;
    justify-content: center;

    width: 330px;
    margin: auto;
    height: 100%;
}

.login-title {
    font-size: 36px;
    font-weight: 700;
    margin-bottom: 24px;
}

.login-btn {
    display: flex;
    align-items: center;
    justify-content: center;

    height: 46px;
    color: #fff;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;

    svg {
        margin-right: 8px;
    }

    &:hover {
        opacity: .86;
    }

    &--apple {
        background: #000; 
    }

    &--wechat {
        background: #00ba5b;
    }

    &--weibo {
        background: #db1228;
    }

    &--mock {
        background: none;

        :deep(.ant-select-selector) {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }

        :deep(.ant-btn) {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
    }
}

.login-foot {
    text-align: center;
    margin-top: 24px;
    font-size: 12px;
    color: rgb(106, 106, 107);
}
</style>

<style>
.mockUserOption {
    height: 38px;
    line-height: 26px!important;
}
</style>