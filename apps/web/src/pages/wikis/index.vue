<script lang="tsx">
import { defineComponent, computed, toRef } from 'vue';
import { storeToRefs } from 'pinia';
import { Button, Dropdown, Menu, Tooltip } from 'ant-design-vue';
import { ChevronDown, Pin, PinOff, FilePenLine, Trash2 } from 'lucide-vue-next';
import { TextButton, Loading } from '@zsfe/zsui';
import { RouterView, useRouter } from 'vue-router';
import i18next from 'i18next';

import { themeTokens } from '@editor/Editor/shared/theme';
import { useWikis } from '@/store/queries/docs/useWikis';
import { useHomeStore } from '@/store/ui-states/home/index';

import { formatTime } from '@/shared/date';

import { useFileAction } from './useFileAction';
import { useContextStore } from '@/store/ui-states/context';

import AddWikiModal from './AddWikiModal.vue';

const MenuItem = Menu.Item;

export default defineComponent({
  props: {
    showFooterText: Boolean,
    searchText: String,
    isFavorite: Boolean,
  },
  setup(props) {
    const router = useRouter();

    const contextStore = useContextStore();
    const { crtSpace } = storeToRefs(contextStore);

    const searchTextRef = toRef(props, 'searchText');

    const { wikis } = useWikis(crtSpace);

    const favoriteWikis = computed(() => {
        return wikis.value?.filter(wiki => wiki.favorite);
    });

    const { handleAddWiki, handleEditWiki, handleDeleteWiki, handleFavoriteClick } = useFileAction();

    const filteredWikis = computed(() => {
        if (!wikis.value) return [];
        if (!searchTextRef.value) return wikis.value;

        return wikis.value.filter((wiki) => {
            let match = wiki.title?.toLowerCase().includes(searchTextRef.value?.toLowerCase());

            return match;
        });
    });

    const handleWikiClick = (wiki) => {
        router.push(`/wikis/wiki/${wiki._id}/`);
    }

    const renderEmpty = () => {
        let text = i18next.t('home.wikis.nowikis');

        if (searchTextRef.value?.length) {
          text = i18next.t('home.main.searchNoResult');
        }

        return (
            <div class="docs-empty">
                <div class="docs-empty_illustration ">
                    <svg height="240" width="240" viewBox="0 0 1024 1024" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg">
                        <path d="M507.314 148.21C522.128 147.185 534.057 151.589 545.58 160.775C547.635 162.413 549.51 165.637 551.681 166.776C559.671 170.969 568.517 173.734 576.654 177.708C595.4 186.863 611.669 199.917 627.316 213.525L646.058 212.977C647.56 209.425 649.211 206.022 651.014 202.614C659.939 205.715 673.508 213.003 682.031 214.372C691.033 215.819 702.018 215.119 711.21 215.285Q740.56 215.625 769.903 216.353C779.016 216.516 789.372 215.835 798.258 217.98C802.458 218.993 805.973 220.898 809.194 223.771C823.072 236.15 818.536 253.397 819.232 269.695Q837.677 277.113 856.275 284.135C862.84 286.661 869.799 288.884 876.009 292.197C873.553 304.233 865.535 323.323 861.1 335.62L829.176 423.671C825.79 433.041 818.448 449.835 816.887 459.044C816.028 464.105 816.433 469.576 816.437 474.696C816.444 484.114 816.514 493.521 816.222 502.936C830.741 512.534 847.453 519.845 861.188 530.589C851.739 549.545 839.338 569.213 828.742 587.746C825.374 593.638 819.556 601.342 817.975 607.719C816.314 614.414 817.534 633.819 817.52 641.79L817.41 743.493L817.515 774.49C817.54 782.002 817.966 789.806 816.797 797.247C815.474 805.667 812.621 813.181 807.198 819.85C784.916 847.253 745.792 834.908 715.525 838.44C715.309 838.465 715.093 838.495 714.877 838.523C707.549 851.353 700.51 864.797 692.529 877.207C685.776 874.308 679.374 869.825 673.089 865.996Q658.829 857.404 644.683 848.626C639.642 845.463 632.835 839.829 627.161 838.505C620.783 837.017 609.576 838.011 602.78 838.02L555.25 837.996L355.164 838.024C319.901 838.013 284.56 838.459 249.318 837.141C241.232 836.839 233.073 836.807 225.003 836.215C216.193 835.568 206.56 835.002 198.485 831.123C188.672 826.409 183.323 816.665 180.261 806.644C172.499 781.244 174.979 746.968 175.011 720.288L174.961 641.396C174.928 631.641 176.065 616.946 174.835 607.826C173.665 599.149 168.993 589.466 165.947 581.2Q156.905 557.033 148.15 532.76Q161.984 527.339 175.954 522.277C175.43 515.92 175.878 509.385 175.993 503.003Q176.221 486.634 176.718 470.272C177.411 446.166 177.594 421.942 177.887 397.825Q178.424 340.417 179.741 283.021C180.093 269.684 178.83 255.596 180.695 242.414C179.574 240.453 178.371 238.548 177.229 236.601C176.335 235.076 175.281 233.409 175.755 231.586C177.808 229.33 180.91 228.712 183.165 226.751C186.728 223.656 188.692 219.092 192.828 216.483C197.872 213.302 204.432 213.788 209.799 211.149C224.305 204.015 238.72 194.484 252.829 186.413C258.038 183.432 263.247 180.2 268.753 177.81C272.589 180.902 275.561 184.753 278.684 188.535Q279.203 187.827 279.74 187.133C286.519 178.31 297.798 171.782 308.821 170.368C320.709 168.842 332.547 172.428 341.933 179.805C352.453 188.074 356.698 198.528 358.217 211.504C371.088 212.072 383.929 211.573 396.805 211.468C411.801 196.352 431.549 183.959 450.675 174.819C456.499 172.036 462.777 170.063 468.515 167.171C470.827 166.006 472.67 162.752 474.69 161.006C483.92 153.026 495.291 149.188 507.314 148.21ZM322.219 255.415C328.786 264.972 336.325 274.739 341.607 285.042C316.172 294.886 291.251 305.826 266.225 316.672C256.394 320.932 239.876 329.398 229.993 331.71L203.286 283.448C198.54 274.968 193.146 266.46 188.965 257.705Q188.807 349.34 186.507 440.946L185.735 494.187C185.584 502.362 185.998 511.023 184.998 519.128C205.121 511.097 225.627 503.861 245.961 496.376C255.153 492.993 266.295 487.957 275.46 485.366Q304.124 569.03 333.683 652.381L359.499 725.329C364.699 740.025 370.362 754.741 374.927 769.644C366.143 775.157 343.543 782.17 332.637 786.26C306.296 796.141 280.013 807.202 253.165 815.6C249.282 808.557 246.578 800.613 243.789 793.083L232.93 763.465L202.956 682.756C196.763 665.909 191.2 648.396 184.011 631.979C184.84 644.638 184.146 657.554 184.101 670.248L184.04 741.454C184.081 756.49 183.742 772.051 185.819 786.956C187.213 796.958 189.573 811.555 197.45 818.805C202.215 823.191 209.139 824.654 215.375 825.412C226.799 826.802 238.459 826.371 249.949 826.749Q293.309 828.139 336.69 827.911L564.377 827.047C569.572 827.036 609.681 826.811 611.304 827.359C611.386 827.387 611.336 827.53 611.352 827.615L611.691 827.191C607.296 823.047 596.316 816.418 590.729 813.815C600.387 788.02 611.613 762.619 622.169 737.166C625.418 729.333 632.019 709.914 636.485 703.976C636.967 703.857 637.482 703.683 637.976 703.644C641.081 701.321 653.886 675.957 657.218 670.486C670.543 647.776 682.892 624.339 695.469 601.202L734.554 529.929L753.824 494.52C757.401 487.931 760.793 479.929 765.607 474.199C771.963 478.167 778.737 481.536 785.306 485.141C792.089 488.864 798.737 492.82 805.465 496.641L805.508 483.466C796.105 479.969 787.04 475.629 777.772 471.796L730.976 452.926C720.329 448.612 709.728 443.959 698.962 439.967C686.83 455.324 675.132 470.969 662.199 485.67C652.692 496.476 642.086 506.406 632.732 517.287C631.063 533.545 626.013 545.248 613.149 555.748C606.715 560.998 600.031 564.199 592.018 566.227C593.494 572.357 595.665 578.272 597.567 584.277C601.213 595.794 604.948 607.61 607.604 619.396C571.035 620.24 534.352 619.069 497.768 619.093L444.351 619.136C436.641 619.143 428.528 619.742 420.861 619.285C421.592 611.446 423.791 603.541 425.508 595.858C427.872 585.275 430.103 574.635 432.646 564.095C418.71 558.06 411.685 551.527 406.11 537.429C403.236 530.161 400.635 522.666 397.213 515.637C388.08 513.645 381.002 510.574 373.768 504.554C359.484 492.668 347.819 473.093 337.053 457.965C325.629 441.913 313.879 426.075 303.257 409.469C294.656 396.021 292.29 383.392 295.728 367.749Q296.752 363.085 298.321 358.576Q299.89 354.066 301.982 349.774C309.265 335.106 319.184 321.145 327.885 307.253C337.894 291.272 347.838 275.387 358.307 259.694C367.238 246.308 376.06 233.249 387.19 221.546C377.386 221.55 367.568 221.442 357.765 221.572C352.901 235.028 344.717 245.853 331.562 252.105C328.568 253.527 325.39 254.477 322.219 255.415ZM317.24 683.057C305.709 686.862 294.35 691.213 282.884 695.215C267.037 700.746 251.077 706 235.368 711.921C230.394 714.022 225.173 715.928 220.413 718.473C224.142 727.91 227.352 737.643 230.929 747.155L254.94 811.061C259.776 809.631 264.522 807.475 269.265 805.739Q287.458 799.137 305.514 792.169C327.128 784.066 349.316 776.826 370.419 767.463C359.384 737.527 349.137 707.285 338.445 677.223C331.464 679.461 324.199 680.759 317.24 683.057ZM180.049 233.558C184.432 242.386 189.764 250.844 194.658 259.402C206.88 280.772 219.746 302.48 230.575 324.594C236.467 322.086 241.762 318.112 247.429 315.119C270.271 303.051 292.804 290.114 316.009 278.782C309.857 267.883 304.509 256.593 298.68 245.527L273.963 199.083C271.615 194.618 269.635 187.325 266.366 183.719C257.083 187.499 246.985 194.616 238.088 199.707C218.65 210.831 199.005 221.624 180.049 233.558ZM733.599 743.59C731.104 749.442 729.348 755.873 727.411 761.937C735.283 766.305 743.7 770.368 751.115 775.469C748.757 781.357 744.737 787.149 741.562 792.642Q731.794 809.7 721.646 826.535C735.666 826.626 758.547 827.816 771.748 825.859C782.872 824.211 793.482 817.79 800.18 808.76C803.511 804.27 806.136 798.459 807.014 792.919C807.583 789.329 807.454 785.464 807.601 781.823C808.069 770.21 807.944 758.578 807.954 746.958Q808.32 702.737 807.58 658.52C807.431 648.323 808.858 635.047 807.443 625.357C802.366 632.409 798.549 642.036 794.293 649.767C781.089 673.753 768.536 698.246 754.869 721.959C754.199 723.122 752.58 726.38 751.23 726.583C748.455 727.002 744.028 723.375 741.625 721.888C738.842 729.082 736.495 736.443 733.599 743.59ZM281.103 192.034Q287.353 201.703 293.324 211.547C302.188 212.098 311.02 211.837 319.891 211.591L354.33 211.396C352.223 199.024 347.845 188.612 337.258 181.148C330.866 176.642 322.728 173.919 314.907 173.69C302.584 174.78 291.632 178.962 283.561 188.758Q282.246 190.332 281.103 192.034ZM334.902 282.769C330.785 275.96 326.754 269.045 322.317 262.441C314.396 250.651 305.798 239.284 298.018 227.408C293.316 220.23 277.469 190.889 272.766 187.33C284.923 212.01 298.489 236.011 310.89 260.586C314.243 267.23 318.788 273.462 321.412 280.424L321.504 280.661C314.559 284.799 307.169 288.307 299.989 292.032Q283.493 300.581 267.127 309.376C261.277 312.497 254.406 315.326 249.121 319.241L249.412 319.238L249.533 318.821L250.223 319.002C252.726 317.986 255.204 316.973 257.63 315.778Q296.09 298.861 334.902 282.769ZM400.874 514.782C404.14 521.477 406.953 528.373 409.842 535.235C415.981 549.82 420.982 555.752 436.518 561.065C440.02 562.263 447.704 564.788 451.174 563.417C451.815 563.163 451.599 563.078 451.847 562.253C450.387 558.578 444.3 554.658 441.194 552.102C431.653 544.384 423.469 535.178 421.866 522.49C421.532 519.848 421.403 517.197 423.083 514.993C424.195 514.275 425.053 514.141 426.341 514.379C432.97 515.599 447.128 528.217 453.528 526.049C453.336 522.772 429.101 500.37 424.812 496.577C423.938 495.804 423.154 495.161 422.1 494.623C417.784 505.048 411.006 510.335 400.874 514.782ZM445.171 510.516C449.85 514.617 456.996 519.973 457.63 526.599C457.763 527.988 457.531 528.774 456.634 529.818C454.093 531.164 450.914 530.753 448.218 529.983C445.966 529.34 443.728 528.18 441.596 527.204C441.498 531.131 438.342 541.318 439.462 544.144C439.786 544.961 440.612 545.829 441.211 546.458C444.813 550.238 455.78 556.809 455.705 562.33C455.684 563.883 455.076 565.462 453.803 566.419C451.08 568.465 446.316 567.651 443.25 566.908C440.871 566.332 438.513 565.642 436.161 564.968C434.335 571.808 433.099 578.836 431.636 585.764Q428.413 600.615 425.339 615.497C448.074 616.295 471.05 615.451 493.819 615.421L602.115 615.479C600.06 607.241 598.025 599.015 595.545 590.892Q591.694 577.35 587.141 564.027C582.475 566.029 575.617 568.826 570.591 566.798C569.416 566.324 568.366 565.427 567.973 564.186C567.255 561.915 568.597 559.246 569.87 557.436C571.596 554.981 574.305 552.881 576.541 550.886C570.06 537.905 564.298 525.031 561.913 510.591C557.856 505.545 559.555 501.086 557.709 495.464C556.948 493.145 556.062 489.978 557.419 487.684C558.209 486.349 559.279 485.436 560.817 485.096C562.612 484.699 564.519 485.158 565.998 486.231C567.3 487.175 568.327 488.515 569.109 489.907C570.862 493.027 571.989 496.541 573.563 499.769Q578.834 510.386 584.627 520.728C591.886 505.921 598.847 490.955 606.204 476.2C605.662 472.617 605.291 468.87 604.192 465.412C598.417 464.667 592.42 464.955 586.607 464.948Q572.787 464.982 558.969 464.804Q507.224 463.782 455.47 463.519Q449.815 486.907 445.171 510.516ZM353.307 221.519C338.295 220.221 322.547 221.218 307.442 221.222L299.28 221.562C305.694 232.263 313.748 241.866 320.343 252.408C326.845 249.983 332.603 247.451 338.08 243.082C345.698 237 350.163 230.737 353.307 221.519Z"></path>
                        <path d="M515.839 682.008C526.946 687.865 537.301 696.253 547.639 703.417Q568.229 717.452 589.187 730.931C584.04 739.243 578.004 746.906 572.342 754.861Q556.241 777.756 539.589 800.253C539.455 800.326 539.33 800.419 539.186 800.471C538.143 800.846 537.647 800.573 536.684 800.096C530.196 796.881 523.98 791.737 518.001 787.615L488.822 767.528C482.003 762.738 475.344 757.648 468.258 753.259C472.981 744.37 479.574 735.767 485.181 727.373C495.312 712.209 505.333 696.914 515.839 682.008Z"></path>
                        <path d="M516.63 687.274C526.304 692.057 535.421 699.43 544.293 705.621Q564.005 719.276 583.987 732.532C577.219 740.498 571.382 749.493 565.331 758.02Q552.36 776.234 539.089 794.23C538.378 795.122 538.3 795.428 537.209 795.871C527.368 790.316 517.807 783.093 508.569 776.563Q491.11 764.327 473.792 751.894Q495.74 719.935 516.63 687.274Z" fill="#FEFEFE"></path>
                        <path d="M429.553 311.486C437.333 319.941 446.596 330.204 457.921 333.58C464.597 345.077 472.988 353.804 484.89 359.981Q486.182 360.648 487.506 361.251Q488.829 361.853 490.181 362.39Q491.533 362.926 492.91 363.395Q494.286 363.864 495.684 364.264Q497.082 364.665 498.498 364.996Q499.915 365.327 501.345 365.587Q502.776 365.848 504.218 366.037Q505.66 366.227 507.109 366.345Q508.559 366.463 510.012 366.51Q511.466 366.556 512.92 366.531Q514.374 366.505 515.825 366.408Q517.276 366.311 518.721 366.142Q520.165 365.974 521.599 365.734Q523.034 365.494 524.455 365.184Q525.875 364.873 527.279 364.493Q528.683 364.113 530.066 363.664C546.07 358.513 558.07 347.297 565.582 332.478C576.059 328.688 583.578 322.597 590.87 314.325C593.769 317.108 596.686 319.826 599.18 322.991C594.22 332.342 590.978 342.705 586.914 352.479C582.188 363.846 575.268 375.833 572.739 387.857C573.488 390.268 574.409 392.29 575.609 394.494C581.631 398.02 588.777 400.236 595.266 402.786C608.638 408.043 621.941 413.202 635.505 417.951C629.423 428.28 621.489 437.292 616.318 448.197C614.801 451.395 609.818 466.695 608.731 467.865L607.992 464.629C607.826 463.474 607.558 462.787 606.971 461.78C604.959 460.592 575.066 461.231 570.743 461.187L482.678 459.987C474.689 459.914 460.245 458.326 453.101 460.138C450.204 462.983 443.069 500.254 441.669 506.871C435.748 501.48 430.073 495.811 424.345 490.216C422.952 484.074 421.795 477.935 419.577 472.018C414.314 457.983 405.714 445.419 397.684 432.866C392.32 424.481 387.118 415.988 381.684 407.649C377.436 401.131 372.374 394.878 368.859 387.937Q389.568 362.779 409.635 337.107C416.348 328.595 423.265 320.33 429.553 311.486Z" fill="#FEFEFE"></path>
                        <path d="M153.208 535.271C178.216 525.29 203.605 516.346 228.862 507.033C243.401 501.673 258.045 495.146 272.945 491.014C275.381 499.253 278.928 507.348 281.744 515.486Q291.435 544.154 301.534 572.681L324.494 638.083C329.066 651.127 333.35 664.377 338.445 677.223C331.464 679.461 324.199 680.759 317.24 683.057C305.709 686.862 294.35 691.213 282.884 695.215C267.037 700.746 251.077 706 235.368 711.921C230.394 714.022 225.173 715.928 220.413 718.473C218.277 711.653 215.475 704.909 212.999 698.199L198.192 658.071L153.208 535.271Z" fill="#FEFEFE"></path>
                        <path d="M235.368 711.921C235.137 711.625 234.803 711.233 234.669 710.884C234.248 709.783 234.421 709.405 234.953 708.483C240.344 705.295 308.922 681.196 314.459 680.436C316.029 680.99 316.28 681.731 317.24 683.057C305.709 686.862 294.35 691.213 282.884 695.215C267.037 700.746 251.077 706 235.368 711.921Z"></path>
                        <path d="M281.121 585.031C281.336 585.024 281.552 584.999 281.766 585.011C283.172 585.089 283.338 585.196 284.271 586.164L283.99 587.025C278.41 591.883 217.461 611.229 206.155 615.48L204.244 615.502C203.129 614.799 203.232 614.711 202.864 613.423C203.398 612.436 204.221 612.09 205.21 611.645C213.883 607.741 223.671 605.07 232.684 601.902C248.793 596.239 264.874 590.272 281.121 585.031Z"></path>
                        <path d="M463.504 173.508C464.187 174.753 462.776 177.245 462.26 178.658C459.96 184.951 458.847 190.34 459.071 197.031C459.674 215.023 472.011 233.161 489.31 238.967C492.154 239.922 498.723 240.077 500.475 241.73L500.532 244.992C500.359 245.29 500.315 245.722 500.012 245.888C498.188 246.882 490.183 247.806 487.117 248.85C473.081 253.629 462.09 264.346 455.652 277.572C447.675 293.962 449.578 311.982 455.282 328.669C448.282 324.633 441.755 319.311 436.657 313.027C434.742 310.666 433.1 307.456 430.665 305.646C429.346 305.918 428.741 306.361 427.846 307.384C424.93 310.715 422.347 314.468 419.609 317.954Q410.401 329.58 401.311 341.298Q382.931 364.646 364.035 387.578C377.782 410.477 392.908 432.575 406.763 455.442C403.373 460.298 399.672 464.658 395.484 468.843Q394.596 469.683 393.671 470.482Q392.746 471.282 391.785 472.038Q390.825 472.795 389.831 473.507Q388.838 474.219 387.813 474.886Q386.788 475.552 385.734 476.172Q384.68 476.792 383.599 477.363Q382.518 477.934 381.413 478.456Q380.307 478.978 379.179 479.449Q378.051 479.92 376.903 480.34Q375.755 480.76 374.589 481.127Q373.422 481.495 372.241 481.809Q371.06 482.124 369.865 482.384Q368.671 482.645 367.466 482.851Q366.261 483.057 365.047 483.209Q363.834 483.361 362.616 483.457Q361.397 483.554 360.175 483.595C355.772 476.585 350.364 469.884 345.514 463.157Q331.038 443.288 317.132 423.016C311.849 415.324 305.836 407.519 302.034 398.969C295.75 384.838 297.961 370.273 303.403 356.254C306.466 348.366 311.396 341.252 315.812 334.068Q326.21 317.162 336.976 300.487C376.304 239.683 394.68 203.765 463.504 173.508Z" fill="#FEFEFE"></path>
                        <path d="M766.614 479.463C782.971 487.872 798.691 497.422 814.542 506.732C828.446 514.898 842.787 522.779 856.11 531.86C849.129 543.568 842.682 555.637 835.951 567.495C826.051 584.937 815.72 602.168 806.035 619.727C787.337 653.624 769.568 688.047 750.569 721.785L749.806 722.217C743.626 719.535 734.379 713.145 728.165 709.531C706.026 696.653 683.73 683.513 662.299 669.497C667.583 660.791 672.178 651.625 677.12 642.719L710.251 582.409Q731.207 544.759 751.646 506.826C756.61 497.688 761.851 488.711 766.614 479.463Z" fill="#FEFEFE"></path>
                        <path d="M726.71 589.196C733.946 591.687 744.931 598.994 752.057 603.025C763.069 609.255 776.689 615.912 786.774 623.074C787.441 624.593 787.044 625.09 786.622 626.657C778.257 623.509 768.419 616.613 760.386 612.053C750.047 606.185 735.814 599.347 726.485 592.546C725.975 591.168 726.341 590.592 726.71 589.196Z"></path>
                        <path d="M555.888 172.893Q559.578 174.282 563.209 175.818Q566.841 177.354 570.407 179.034Q573.974 180.715 577.47 182.538Q580.967 184.36 584.387 186.322Q587.807 188.283 591.146 190.38Q594.485 192.477 597.736 194.707Q600.988 196.937 604.148 199.295Q607.308 201.654 610.37 204.137C622.024 213.411 632.748 224.631 642.835 235.555Q660.679 255.173 677.259 275.87Q693.84 296.567 709.092 318.261C716.5 328.585 725.128 339.25 730.665 350.722Q731.466 352.398 732.122 354.136Q732.778 355.874 733.284 357.662Q733.791 359.449 734.144 361.273Q734.497 363.097 734.695 364.944C735.628 374.092 733.691 382.48 729.772 390.726C723.457 404.012 713.195 414.752 704.256 426.249C691.758 442.324 679.464 458.42 666.664 474.268C662.554 473.409 658.609 472.454 654.633 471.099C641.481 466.007 630.269 455.896 623.341 443.647C636.824 423.603 650.565 403.709 663.796 383.498C639.68 358.332 614.83 333.794 591.071 308.285C581.456 317.044 580.21 320.431 568.006 327.393C571.859 314.531 572.141 303.526 569.168 290.473C575.414 285.656 580.907 279.816 584.628 272.822Q585.172 271.808 585.664 270.768Q586.157 269.728 586.596 268.665Q587.036 267.601 587.421 266.517Q587.806 265.433 588.136 264.33Q588.466 263.228 588.74 262.111Q589.014 260.993 589.232 259.863Q589.449 258.733 589.609 257.594Q589.769 256.454 589.872 255.308Q589.974 254.162 590.019 253.013Q590.064 251.863 590.05 250.712Q590.037 249.562 589.966 248.413Q589.895 247.265 589.765 246.121Q589.636 244.978 589.45 243.843Q589.263 242.707 589.02 241.583Q588.776 240.458 588.476 239.347Q588.176 238.236 587.821 237.142C583.3 222.936 573.397 213.933 560.54 207.188C563.27 195.272 560.768 183.86 555.888 172.893Z" fill="#FEFEFE"></path>
                        <path d="M638.634 708.717C648.318 711.62 658.094 716.461 667.479 720.279Q698.294 732.785 728.959 745.654C726.6 753.888 691.571 848.385 690.411 849.795C690.171 850.086 689.811 850.254 689.512 850.484L687.839 849.998C657.64 836.497 627.398 823.177 596.218 812.054C601.834 794.788 610.214 776.874 617.172 759.943C624.055 743.198 630.604 724.844 638.634 708.717Z" fill="#FEFEFE"></path>
                        <path d="M652.146 207.276C663.487 211.616 674.475 216.734 685.743 221.233L786.853 261.374L841.12 282.66C851.034 286.5 861.536 289.796 871.041 294.517C869.391 302.617 865.94 310.695 863.138 318.463L848.97 357.477L819.627 438.439C814.656 451.75 809.887 465.157 804.211 478.19C792.075 473.772 780.176 468.457 768.218 463.567L710.824 440.522L701.448 436.737C704.006 433.435 706.635 430.265 709.435 427.166Q731.885 435.592 754.13 444.545C763.344 448.212 773.486 453.43 783.196 455.142C787.018 455.816 790.898 455.533 794.509 454.054C799.602 451.968 802.771 447.784 804.835 442.828C812.927 423.4 819.275 401.685 826.698 381.784C832.462 366.331 838.429 350.973 844.063 335.469C846.523 328.699 849.713 321.549 851.202 314.52C851.968 310.906 851.697 307.378 850.184 303.981C848.389 299.952 844.544 296.17 840.739 293.966C831.162 288.42 814.791 283.997 803.926 279.524Q757.781 260.734 711.236 242.957C698.675 238.105 686.211 232.737 673.582 228.121C668.627 226.309 663.429 225.28 658.471 227.73C654.189 229.846 652.022 233.501 650.464 237.803L643.408 229.817C647.062 222.737 649.459 214.777 652.146 207.276Z" fill="#FEFEFE"></path>
                        <path d="M508.284 151.689C510.444 151.509 512.524 151.554 514.682 151.727C527.465 152.753 538.798 158.131 547.039 168.023C556.62 179.521 558.518 191.701 557.138 206.242C549.069 204.238 540.825 204.029 532.755 206.162C520.304 209.452 511.671 217.162 505.302 228.093C503.784 231.115 502.762 234.452 501.625 237.638C493.32 236.811 486.362 234.678 479.74 229.469Q478.877 228.787 478.049 228.063Q477.221 227.339 476.43 226.575Q475.639 225.811 474.887 225.008Q474.135 224.206 473.424 223.367Q472.713 222.528 472.045 221.654Q471.376 220.781 470.752 219.876Q470.128 218.97 469.549 218.035Q468.971 217.1 468.439 216.137Q467.908 215.174 467.425 214.185Q466.942 213.197 466.509 212.186Q466.076 211.175 465.694 210.144Q465.312 209.113 464.981 208.064Q464.651 207.015 464.373 205.951Q464.095 204.887 463.87 203.81Q463.645 202.733 463.475 201.647Q463.304 200.561 463.187 199.467Q463.076 198.472 463.015 197.473Q462.955 196.473 462.944 195.472Q462.933 194.471 462.972 193.47Q463.012 192.47 463.101 191.473Q463.19 190.475 463.329 189.484Q463.468 188.492 463.656 187.509Q463.845 186.526 464.082 185.553Q464.319 184.58 464.605 183.621Q464.89 182.661 465.224 181.717Q465.557 180.773 465.937 179.846Q466.317 178.92 466.743 178.014Q467.169 177.108 467.639 176.224Q468.11 175.34 468.624 174.481Q469.138 173.622 469.695 172.79Q470.251 171.958 470.849 171.154Q471.446 170.351 472.083 169.578C481.597 157.885 493.605 153.278 508.284 151.689Z" fill="#FEFEFE"></path>
                        <path d="M657.218 670.486C665.972 677.376 676.43 682.813 685.988 688.569L741.625 721.888C738.842 729.082 736.495 736.443 733.599 743.59C726.971 740.054 719.489 737.665 712.526 734.816L664.537 715.23C655.72 711.592 646.321 708.232 637.976 703.644C641.081 701.321 653.886 675.957 657.218 670.486Z" fill="#FEFEFE"></path>
                        <path d="M726.199 765.626C733.006 769.097 739.507 773.427 746.033 777.41C726.829 808.478 709.422 840.718 690.984 872.245C671.799 860.38 652.143 849.303 633.286 836.875C625.622 831.931 618.069 826.826 610.314 822.022C631.172 828.525 651.332 838.15 671.337 846.885C677.028 849.369 682.807 852.511 688.594 854.631C689.825 855.082 690.793 855.3 692.109 855.062C693.18 854.029 693.663 852.961 694.235 851.594C696.206 846.876 697.434 841.798 699.232 837.003L726.199 765.626Z" fill="#FEFEFE"></path>
                        <path d="M608.22 480.834C609.779 482.324 610.808 485.159 612.036 487.01C618.909 497.365 629.339 500.095 640.804 502.255C637.117 507.444 632.012 511.639 628.494 516.946C624.556 522.888 622.796 530.31 619.597 536.685C613.341 549.156 603.515 558.031 590.306 562.428C593.598 559.975 597.032 557.728 600.338 555.298C607.905 549.734 616.027 539.107 617.227 529.564C617.371 528.42 617.418 528.342 616.712 527.38C616.472 527.405 616.224 527.392 615.991 527.455C613.341 528.176 610.407 537.17 609.149 539.747Q608.189 541.307 607.12 542.795Q606.05 544.283 604.877 545.69Q603.704 547.097 602.433 548.417Q601.161 549.736 599.799 550.961Q598.437 552.186 596.99 553.31Q595.543 554.435 594.02 555.452Q592.496 556.47 590.904 557.376Q589.311 558.282 587.658 559.071C583.515 561.042 576.686 564.615 572.054 562.993L571.85 562.286C573.916 558.201 577.607 555.617 581 552.698C589.077 545.748 595.028 535.715 599.324 526.067C599.969 524.619 601.117 522.858 601.124 521.256C601.129 520.343 601.157 520.689 600.442 519.865L599.045 519.982C597.928 520.661 596.992 521.297 596.293 522.43C595.27 524.087 594.728 526.209 593.898 527.987C592.451 531.086 590.756 534.109 589.156 537.133C587.963 534.485 586.997 531.739 585.981 529.019C593.472 512.966 600.448 496.782 608.22 480.834Z" fill="#FEFEFE"></path>
                        <path d="M708.654 225.896C726.422 225.616 744.432 226.522 762.206 226.904C771.578 227.106 785.167 226.367 794.109 228.098C797.16 228.688 800.151 230.201 802.526 232.193C811.277 239.531 808.601 255.384 809.476 265.691C796.838 261.032 784.399 255.81 771.821 250.982C750.687 242.87 729.405 234.957 708.654 225.896Z" fill="#FEFEFE"></path>
                        <path d="M601.949 325.919C605.099 328.804 608.189 331.758 611.303 334.682C607.892 341.422 605.135 348.739 602.161 355.706C598.715 363.778 593.349 373.228 597.154 382.078C598.473 385.148 600.7 387.611 603.43 389.503C610.798 394.608 634.03 402.396 643.694 406.147C642.119 408.506 640.068 412.41 637.756 414.022C636.932 414.597 636.471 414.21 635.54 414.014C626.279 410.477 583.405 394.982 577.671 390.695C576.836 388.742 577.768 385.843 578.363 383.88C580.729 376.078 584.55 368.408 587.734 360.889Q595.102 343.51 601.949 325.919Z" fill="#FEFEFE"></path>
                        <path d="M426.172 519.25C429.823 519.582 434.386 522.953 437.586 524.829C437.545 528.018 437.221 530.99 436.69 534.134L435.934 534.237C432.937 529.717 427.594 524.456 426.172 519.25Z" fill="#FEFEFE"></path>
                    </svg>

                </div>
                <div class="docs-empty_text">
                    {text}
                </div>
            </div>
        );
    }

    const renderFavoriteWikis = () => {
        if (!favoriteWikis.value?.length) return '';

        // 如果有筛选， 则不显示置顶
        if (searchTextRef.value?.length) return '';

        return (
            <div>
                <div class="subTitle">置顶文档集</div>
                <div class="wikis">
                    {favoriteWikis.value?.map((wiki) => (
                        renderWiki(wiki)
                    ))}
                </div>
            </div>
        )
    }

    const renderWiki = (wiki) => {
        return (
            <Dropdown trigger="contextmenu">
                {{
                    default: () => (
                        <div class="wiki relative" onClick={() => handleWikiClick(wiki)} style={{ '--wiki-cover': `url(${wiki.cover || 'https://fastly.picsum.photos/id/507/160/220.jpg?hmac=Z8Z1L-Kysv4EqSC1otXyCR2tQABHqadAa5pe5b7fETQ'})`}}>
             
                            <div class="wiki-main">
                                <div class="wiki-cover">
                                    
                                </div>

                                <div class="wiki_title">
                                    {wiki.title || '-'}
                                </div>
                                <div class="wiki_desc">
                                    {wiki.desc}
                                </div>
                            </div>
                        </div>
                    ),
                    overlay: () => (
                        <div class="w-[160px]">
                            <Menu
                                class={['customMenu']}
                                mode="inline"
                                selectedKeys={[]}
                                >
                                    <MenuItem 
                                        key="1" 
                                        icon={wiki.favorite ? <PinOff width={18} height={18} color={themeTokens.lightTextColor()} /> : <Pin width={18} height={18} color={themeTokens.lightTextColor()} />} 
                                        class="flex items-center"
                                        onClick={() => handleFavoriteClick(wiki)}
                                    >
                                        {wiki.favorite ? '取消置顶' : '置顶'}
                                    </MenuItem>
                                    <MenuItem key="2" icon={<FilePenLine width={18} height={18} color={themeTokens.lightTextColor()} />} class="flex items-center" onClick={() => handleEditWiki(wiki)}>
                                        修改
                                    </MenuItem>
                                    <MenuItem key="3" icon={<Trash2 width={18} height={18} color={themeTokens.lightTextColor()} />} class="flex items-center" onClick={() => handleDeleteWiki(wiki.id)}>
                                        删除
                                    </MenuItem>
                                </Menu>
                        </div>
                    )
                }}
            </Dropdown>
        );
    }

    const renderWikis = () => {
        if (!filteredWikis.value?.length) return renderEmpty();

        return filteredWikis.value?.map((wiki) => (
            renderWiki(wiki)
        ));
    }

    return () => (
      <div>
        <div class="docs-head flex items-center justify-between">
            <div>{i18next.t('home.wikis.title')}</div>
            <div style="height: 32px;">
                <Button type="primary" onClick={handleAddWiki}>
                    <div class="flex items-center">
                        {i18next.t('home.wikis.createWikiBtnText')}
                        <ChevronDown class="ml-1" width="18" height="18" />
                    </div>    
                </Button>
            </div>
        </div>
        <div class="">
            {renderFavoriteWikis()}

            <div class="subTitle">所有文档集</div>
            <div class="wikis">
                {renderWikis()}
            </div>
        </div>
       

        <AddWikiModal />

        <RouterView />
      </div>
    );
  }
});
</script>

<style scoped lang="less">

.subTitle {
    height: 44px;
    line-height: 44px;
    padding: 1px 24px 0;
    font-size: 16px;
    font-weight: 500;
    margin-top: 20px;
}

.wikis {
    padding: 20px 24px 32px 24px;
    display: flex;
    align-items: center;
    gap: 20px;
    flex-wrap: wrap;
}

.wiki-cover {
    width: 100%;
    height: 120px;
    background: var(--wiki-cover);
    background-size: cover;
    border-radius: 6px;
}

.docs-head {
    position: sticky;
    top: 0;
    background: var(--blur-bg);
    backdrop-filter: blur(4px);
    z-index: 1;

    padding: 18px 24px 18px 26px;
    font-size: 20px;
    font-weight: 500;
    border-bottom: 1px solid var(--default-border-color);
}

.docs-footer {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px 0;
    text-align: center;
    color: #8f959e;
}

.docs-footer:before {
    display: inline-flex;
    content: "";
    height: 1px;
    width: 5%;
    background: linear-gradient(90deg, #8f959e00, #8f959e);
}

.docs-footer:after {
    display: inline-flex;
    content: "";
    height: 1px;
    width: 5%;
    background: linear-gradient(90deg, #8f959e, #8f959e00);
}

.docs-empty, .docs-loading {
    text-align: center;
    margin: 100px auto;
    width: 400px;
    left: 0;
    right: 0;
}

.docs-empty_illustration {
    display: flex;
    justify-content: center;
}

.docs-empty_text {
    color: #646a73;
}
</style>

<style scoped src="./index.less"></style>